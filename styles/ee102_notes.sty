%% ee102_notes.sty  v1.0  (2025/08/27)
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{ee102_notes}[2025/08/27 EE102 Lecture Notes macros]

\RequirePackage{latexsym,amssymb,amsmath,amsfonts,verbatim}
\renewcommand{\ttdefault}{cmtt}
\RequirePackage{array,multirow,color,multicol,graphicx,fancyhdr,tabularx}

% geometry
\setlength{\oddsidemargin}{0pt}
\setlength{\evensidemargin}{0pt}
\setlength{\textwidth}{6.5in}
\setlength{\textheight}{8.5in}
\setlength{\parskip}{1pc}
\setlength{\parindent}{0pt}
\setlength{\headheight}{15pt}
\addtolength{\topmargin}{-2.49998pt}
% public config (overridable in macros.tex)
\providecommand{\course}{EE 102}
\providecommand{\coursetitle}{Signal Processing and Linear Systems}
\providecommand{\instructor}{Ayush Pandey}
\providecommand{\releasedate}{}
\providecommand{\duedate}{}
\providecommand{\student}{}  
\providecommand{\semester}{Fall 2025} 
\providecommand{\year}{2025} 
\providecommand{\psetnum}{0} 
\newcommand{\coursefull}{\course: \coursetitle}
\providecommand{\shorttitle}{Lecture Notes}

\makeatletter

% header for lecture notes
\newcommand{\notesheader}{%
  \pagestyle{fancy}%
  \fancyhf{}%
  \lhead{\semester \ \year \ \course}
  \chead{\shorttitle}
  \rhead{Instructor: \instructor}
  \cfoot{\thepage}%
  \noindent\vspace{0.5em}
  \centerline{\bfseries \course: \coursetitle}
  \vspace{0.5em}
}

\makeatother

% tolerances / floats
\hfuzz=1pt
\setcounter{topnumber}{3}\renewcommand\topfraction{.7}
\setcounter{bottomnumber}{1}\renewcommand\bottomfraction{.3}
\setcounter{totalnumber}{5}\renewcommand\textfraction{.1}
\renewcommand\floatpagefraction{.7}
\setcounter{dbltopnumber}{2}
\renewcommand\dbltopfraction{.7}
\renewcommand\dblfloatpagefraction{.7}




% ======= Pop-Quiz for EE102 (boxed quiz + solutions at end) ==================
\RequirePackage[most]{tcolorbox}
\RequirePackage{etoolbox} % for \tcbstartrecording/\tcbinputrecords

% Splitter used inside the environment (avoid clashing with \solution)
\newcommand{\popqsplit}{\tcblower}

% Flag: print the solutions section only if at least one quiz occurred
\newif\ifEEPopQuizHasSolutions
\EEPopQuizHasSolutionsfalse

% Start/stop recording all "records=" emitted by popquiz boxes
\AtBeginDocument{\tcbstartrecording}
\AtEndDocument{%
  \tcbstoprecording
  \ifEEPopQuizHasSolutions
    \clearpage
    \section*{Pop Quiz Solutions}
    \tcbinputrecords
  \fi
}

% Pop-quiz box:
%  - numbered within sections; for global numbering, remove "number within=section"
%  - anything after \popqsplit is hidden inline, saved to a file, and replayed at the end
\newtcolorbox[
  auto counter,
  number within=section
]{popquiz}[1][]{%
  enhanced jigsaw,
  breakable,
  colback=gray!10,
  colframe=black,
  fonttitle=\bfseries,
  title={Pop Quiz \thetcbcounter: Check your understanding!},
  label={popquiz-\thetcbcounter},
  lowerbox=ignored, % hide solution inline
  savelowerto=popquiz-\thetcbcounter.tex, % writes alongside your .tex
  record={\string\EEPopQuizRender{\thetcbcounter}{popquiz-\thetcbcounter.tex}},
  after upper={%
    \global\EEPopQuizHasSolutionstrue
    \par\hfill\itshape Solution on page~\pageref{popquiz-sol-\thetcbcounter}%
  },
  #1
}

% Renderer used at the end for each recorded solution
\NewTotalTColorBox{\EEPopQuizRender}{mm}{%
  enhanced jigsaw,
  breakable,
  fonttitle=\bfseries,
  title={Pop Quiz #1: Solution(s)},
  phantomlabel={popquiz-sol-#1}
}{%
  \input{#2}%
}

